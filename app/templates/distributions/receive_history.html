{% extends "base.html" %}

{% block title %}Riwayat Terima Distribusi - Smart Geo Inventory{% endblock %}

{% block page_title %}Riwayat Terima Distribusi{% endblock %}

{% block content %}
<!-- Header with Back Button -->
<div class="flex items-center justify-between mb-6">
    <div>
        <h2 class="text-2xl font-bold text-gray-800">Riwayat Terima Distribusi</h2>
        <p class="text-sm text-gray-600 mt-1">Daftar batch distribusi yang telah diterima di unit Anda</p>
    </div>
    <a href="{{ url_for('distributions.receive_index') }}"
       class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-semibold inline-flex items-center shadow-sm">
        <i class="fas fa-arrow-left mr-2"></i>
        Kembali
    </a>
</div>

<!-- Info Banner -->
<div class="bg-indigo-50 border border-indigo-200 rounded-xl p-6 mb-6">
    <div class="flex items-start">
        <div class="bg-indigo-100 rounded-lg p-2 mr-4">
            <i class="fas fa-history text-indigo-600 text-xl"></i>
        </div>
        <div>
            <h4 class="font-semibold text-indigo-900 mb-2">Riwayat Penerimaan</h4>
            <p class="text-sm text-indigo-800">
                Berikut adalah daftar seluruh batch distribusi yang telah berhasil diterima di unit Anda.
                Setiap batch berisi beberapa barang yang telah dikirim bersamaan dari warehouse.
            </p>
        </div>
    </div>
</div>

<!-- Distribution History -->
{% if history_list and history_list|length > 0 %}
<div class="space-y-6">
    {% for history in history_list %}
    <div class="bg-white rounded-xl shadow-md">
        <!-- Batch Header -->
        <div class="p-6 border-b border-gray-200">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="bg-green-100 rounded-lg p-3">
                        <i class="fas fa-check-circle text-green-600 text-xl"></i>
                    </div>
                    <div>
                        <span class="text-lg font-bold text-gray-800">
                            {{ history.group.batch_code }}
                        </span>
                        <span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-semibold ml-2">
                            <i class="fas fa-check mr-1"></i>Diterima
                        </span>

                        <div class="flex items-center space-x-4 mt-2 text-sm text-gray-600">
                            <span>
                                <i class="fas fa-warehouse mr-1"></i>
                                {{ history.warehouse.name if history.warehouse else 'Warehouse Tidak Diketahui' }}
                            </span>
                            <span>
                                <i class="fas fa-boxes mr-1"></i>
                                {{ history.total_items }} Barang
                            </span>
                            <span>
                                <i class="fas fa-calendar-check mr-1"></i>
                                Diterima: {{ history.group.verification_received_at.strftime('%d %B %Y, %H:%M') }}
                            </span>
                        </div>
                    </div>
                </div>
                <div class="text-right">
                    {% if history.group.verification_photo %}
                    <a href="{{ url_for('distributions.proof_photo', id=history.distributions[0].id) }}"
                       target="_blank"
                       class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold inline-flex items-center text-sm">
                        <i class="fas fa-camera mr-2"></i>
                        Lihat Bukti
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Items in this batch -->
        <div class="p-6 bg-gray-50">
            <h4 class="text-sm font-semibold text-gray-700 mb-4">
                <i class="fas fa-boxes mr-1"></i>
                Daftar Barang dalam Batch Ini ({{ history.total_items }} item)
            </h4>
            <div class="overflow-x-auto">
                <table class="w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Barang</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Serial Number</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Lokasi Tujuan</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipe</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Waktu Distribusi</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        {% for dist in history.distributions %}
                        <tr>
                            <td class="px-4 py-4 whitespace-nowrap">
                                <div class="text-sm font-medium text-gray-900">
                                    {{ dist.item_detail.item.name if dist.item_detail and dist.item_detail.item else 'Item Tidak Diketahui' }}
                                </div>
                            </td>
                            <td class="px-4 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-500">
                                    <i class="fas fa-barcode mr-1"></i>
                                    {{ dist.item_detail.serial_number if dist.item_detail else '-' }}
                                </div>
                            </td>
                            <td class="px-4 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-500">
                                    <i class="fas fa-map-marker-alt mr-1"></i>
                                    {{ dist.unit_detail.room_name if dist.unit_detail else 'Main Location' }}
                                </div>
                            </td>
                            <td class="px-4 py-4 whitespace-nowrap">
                                <span class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs font-semibold">
                                    <i class="fas fa-check mr-1"></i>Terpasang
                                </span>
                            </td>
                            <td class="px-4 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-500">
                                    {% if dist.task_type == 'installation' %}
                                    <i class="fas fa-tools text-indigo-600 mr-1"></i>Instalasi
                                    {% else %}
                                    <i class="fas fa-truck text-green-600 mr-1"></i>Pengiriman
                                    {% endif %}
                                </div>
                            </td>
                            <td class="px-4 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-500">
                                    <i class="fas fa-clock mr-1"></i>
                                    {{ dist.distribution_group.verified_at|format_wib_datetime }}
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<!-- Empty State -->
<div class="bg-white rounded-xl shadow-md p-12 text-center">
    <i class="fas fa-inbox text-gray-400 text-6xl mb-4"></i>
    <h3 class="text-xl font-semibold text-gray-800 mb-2">Belum Ada Riwayat Penerimaan</h3>
    <p class="text-gray-600 mb-6">Anda belum menerima batch distribusi apapun. Riwayat akan muncul di sini setelah Anda mengonfirmasi penerimaan batch.</p>
    <a href="{{ url_for('distributions.receive_index') }}"
       class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-semibold inline-flex items-center">
        <i class="fas fa-list mr-2"></i>
        Lihat Batch Pending
    </a>
</div>
{% endif %}
{% endblock %}
