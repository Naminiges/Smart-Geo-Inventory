{% extends "base.html" %}

{% block title %}Detail Instalasi - Smart Geo Inventory{% endblock %}

{% block page_title %}Detail Instalasi{% endblock %}

{% block content %}
<div class="fade-in">
    <div class="max-w-4xl mx-auto">
        <!-- Back Button -->
        <div class="mb-3">
            <a href="{{ url_for('installations.index') }}" class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                <i class="fas fa-arrow-left mr-2"></i> Kembali ke Daftar
            </a>
        </div>

        <!-- Main Info Card -->
        <div class="bg-white rounded-xl shadow-md mb-4 overflow-hidden">
            <div class="bg-primary text-white px-6 py-4">
                <div class="flex justify-between items-center">
                    <div>
                        <h5 class="text-lg font-semibold mb-1">
                            <i class="fas fa-tools mr-2"></i>Instalasi #{{ distribution.id }}
                        </h5>
                        <small class="opacity-90">{{ distribution.item_detail.item.name }}</small>
                    </div>
                    <div>
                        {% if distribution.status == 'installing' %}
                            <span class="bg-white text-primary px-3 py-1 rounded-full text-sm font-medium">
                                <i class="fas fa-clock mr-1"></i> Sedang Dipasang
                            </span>
                        {% elif distribution.status == 'installed' %}
                            <span class="bg-white text-success px-3 py-1 rounded-full text-sm font-medium">
                                <i class="fas fa-check-circle mr-1"></i> Terpasang
                            </span>
                        {% elif distribution.status == 'broken' %}
                            <span class="bg-white text-danger px-3 py-1 rounded-full text-sm font-medium">
                                <i class="fas fa-exclamation-triangle mr-1"></i> Rusak
                            </span>
                        {% elif distribution.status == 'maintenance' %}
                            <span class="bg-white text-warning px-3 py-1 rounded-full text-sm font-medium">
                                <i class="fas fa-tools mr-1"></i> Maintenance
                            </span>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h6 class="text-sky-600 mb-3"><i class="fas fa-box mr-2"></i>Informasi Barang</h6>
                        <div class="space-y-2">
                            <div class="flex">
                                <span class="text-gray-500 w-2/5">Serial Number:</span>
                                <span class="font-semibold">{{ distribution.item_detail.serial_number }}</span>
                            </div>
                            <div class="flex">
                                <span class="text-gray-500 w-2/5">Nama Barang:</span>
                                <span>{{ distribution.item_detail.item.name }}</span>
                            </div>
                            <div class="flex">
                                <span class="text-gray-500 w-2/5">Kode Barang:</span>
                                <span>{{ distribution.item_detail.item.item_code }}</span>
                            </div>
                            <div class="flex">
                                <span class="text-gray-500 w-2/5">Kategori:</span>
                                <span>{{ distribution.item_detail.item.category.name }}</span>
                            </div>
                            <div class="flex">
                                <span class="text-gray-500 w-2/5">Spesifikasi:</span>
                                <span>{{ distribution.item_detail.specification_notes or '-' }}</span>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h6 class="text-green-600 mb-3"><i class="fas fa-map-marker-alt mr-2"></i>Informasi Lokasi</h6>
                        <div class="space-y-2">
                            <div class="flex">
                                <span class="text-gray-500 w-2/5">Unit:</span>
                                <span class="font-semibold">{{ distribution.unit.name }}</span>
                            </div>
                            <div class="flex">
                                <span class="text-gray-500 w-2/5">Ruangan:</span>
                                <span>{{ distribution.unit_detail.room_name }}</span>
                            </div>
                            {% if distribution.unit_detail.floor %}
                            <div class="flex">
                                <span class="text-gray-500 w-2/5">Lantai:</span>
                                <span>{{ distribution.unit_detail.floor }}</span>
                            </div>
                            {% endif %}
                            <div class="flex">
                                <span class="text-gray-500 w-2/5">Alamat:</span>
                                <span>{{ distribution.address }}</span>
                            </div>
                            <div class="flex">
                                <span class="text-gray-500 w-2/5">Koordinat:</span>
                                <span>
                                    {% if distribution.geom %}
                                        <a href="https://maps.google.com/?q={{ distribution.lat }},{{ distribution.lon }}"
                                           target="_blank" class="text-sky-600 hover:text-sky-700">
                                            <i class="fas fa-map mr-1"></i>
                                            {{ distribution.lat }}, {{ distribution.lon }}
                                        </a>
                                    {% else %}
                                        -
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Additional Info Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div class="bg-white rounded-xl shadow-md h-full">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h6 class="font-semibold mb-0">
                        <i class="fas fa-user mr-2"></i>Field Staff
                    </h6>
                </div>
                <div class="p-6">
                    <h5 class="text-lg mb-1">{{ distribution.field_staff.name }}</h5>
                    <p class="text-gray-500 mb-2">{{ distribution.field_staff.email }}</p>
                    <span class="inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm">{{ distribution.field_staff.role|title }}</span>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-md h-full">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h6 class="font-semibold mb-0">
                        <i class="fas fa-building mr-2"></i>Warehouse Asal
                    </h6>
                </div>
                <div class="p-6">
                    <h5 class="text-lg mb-1">{{ distribution.warehouse.name }}</h5>
                    <p class="text-gray-500 mb-0">{{ distribution.warehouse.address }}</p>
                </div>
            </div>
        </div>

        <!-- Timeline Card -->
        <div class="bg-white rounded-xl shadow-md mb-4">
            <div class="px-6 py-4 border-b border-gray-200">
                <h6 class="font-semibold mb-0">
                    <i class="fas fa-history mr-2"></i>Timeline
                </h6>
            </div>
            <div class="p-6">
                <div class="relative pl-8">
                    <div class="absolute left-3 top-0 bottom-0 w-0.5 bg-gray-200"></div>
                    <div class="relative pb-6 last:pb-0">
                        <div class="absolute left-[-26px] top-1 w-3 h-3 bg-sky-500 rounded-full border-2 border-white shadow-md"></div>
                        <div class="ml-2">
                            <h6 class="mb-1">Tanggal Instalasi</h6>
                            <p class="text-gray-500 mb-0">
                                <i class="fas fa-calendar mr-1"></i>
                                {{ distribution.installed_at.strftime('%d %B %Y') }}
                            </p>
                        </div>
                    </div>
                    <div class="relative pb-0">
                        <div class="absolute left-[-26px] top-1 w-3 h-3 bg-gray-400 rounded-full border-2 border-white shadow-md"></div>
                        <div class="ml-2">
                            <h6 class="mb-1">Terakhir Diupdate</h6>
                            <p class="text-gray-500 mb-0">
                                <i class="fas fa-clock mr-1"></i>
                                {{ distribution.updated_at.strftime('%d %B %Y %H:%M') }}
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Card -->
        {% if distribution.note %}
        <div class="bg-white rounded-xl shadow-md mb-4">
            <div class="px-6 py-4 border-b border-gray-200">
                <h6 class="font-semibold mb-0">
                    <i class="fas fa-sticky-note mr-2"></i>Catatan
                </h6>
            </div>
            <div class="p-6">
                <p class="mb-0">{{ distribution.note }}</p>
            </div>
        </div>
        {% endif %}

        <!-- Actions Card -->
        <div class="bg-white rounded-xl shadow-md">
            <div class="px-6 py-4 border-b border-gray-200">
                <h6 class="font-semibold mb-0">
                    <i class="fas fa-bolt mr-2"></i>Aksi
                </h6>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                    {% if distribution.status == 'installing' %}
                    <a href="{{ url_for('installations.update_status', id=distribution.id, status='installed') }}"
                       class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-center transition-colors">
                        <i class="fas fa-check-circle mr-1"></i> Tandai Terpasang
                    </a>
                    <a href="{{ url_for('installations.update_status', id=distribution.id, status='maintenance') }}"
                       class="bg-amber-500 hover:bg-amber-600 text-white px-4 py-2 rounded-lg text-center transition-colors">
                        <i class="fas fa-tools mr-1"></i> Mulai Maintenance
                    </a>
                    {% elif distribution.status == 'installed' %}
                    <a href="{{ url_for('installations.update_status', id=distribution.id, status='maintenance') }}"
                       class="bg-amber-500 hover:bg-amber-600 text-white px-4 py-2 rounded-lg text-center transition-colors">
                        <i class="fas fa-tools mr-1"></i> Mulai Maintenance
                    </a>
                    <a href="{{ url_for('installations.update_status', id=distribution.id, status='broken') }}"
                       class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-center transition-colors">
                        <i class="fas fa-exclamation-triangle mr-1"></i> Lapor Rusak
                    </a>
                    {% elif distribution.status == 'maintenance' %}
                    <a href="{{ url_for('installations.update_status', id=distribution.id, status='installed') }}"
                       class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-center transition-colors">
                        <i class="fas fa-check-circle mr-1"></i> Selesai Maintenance
                    </a>
                    {% elif distribution.status == 'broken' %}
                    <a href="{{ url_for('installations.update_status', id=distribution.id, status='maintenance') }}"
                       class="bg-amber-500 hover:bg-amber-600 text-white px-4 py-2 rounded-lg text-center transition-colors">
                        <i class="fas fa-tools mr-1"></i> Mulai Perbaikan
                    </a>
                    {% endif %}
                    <a href="https://maps.google.com/?q={{ distribution.lat }},{{ distribution.lon }}"
                       target="_blank" class="border border-blue-500 text-blue-500 hover:bg-blue-50 px-4 py-2 rounded-lg text-center transition-colors">
                        <i class="fas fa-map mr-1"></i> Lihat di Google Maps
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
