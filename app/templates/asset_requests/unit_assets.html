{% extends "base.html" %}

{% block title %}Aset di Unit - Smart Geo Inventory{% endblock %}
{% block page_title %}Aset di Unit{% endblock %}
{% set page_icon = 'fas fa-box-open' %}
{% set page_description = 'Daftar aset di unit' %}
{% block page_header_actions %}
<a href="{{ url_for('asset_requests.index') }}" class="px-5 py-2.5 bg-gradient-to-r from-emerald-600 to-emerald-700 text-white rounded-xl hover:from-emerald-700 hover:to-emerald-800 transition-all font-semibold shadow-md hover:shadow-lg inline-flex items-center">
  <i class="fas fa-plus mr-2"></i>Permohonan Aset
</a>
{% endblock %}
{% block content %}

<!-- Units Information -->
{% if units|length == 1 %}
<div class="bg-white rounded-xl shadow-md mb-6">
    <div class="p-6 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-800">
            <i class="fas fa-building mr-2 text-orange-600"></i>
            Informasi Unit
        </h3>
    </div>
    <div class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="bg-gray-50 rounded-lg p-4">
                <h4 class="text-sm font-semibold text-gray-600 mb-2">Nama Unit</h4>
                <p class="text-base font-semibold text-gray-800">{{ units[0].name }}</p>
            </div>
            <div class="bg-gray-50 rounded-lg p-4">
                <h4 class="text-sm font-semibold text-gray-600 mb-2">Alamat</h4>
                <p class="text-base text-gray-800">{{ units[0].address[:80] }}{{ '...' if units[0].address and units[0].address|length > 80 else '' }}</p>
            </div>
            <div class="bg-gray-50 rounded-lg p-4">
                <h4 class="text-sm font-semibold text-gray-600 mb-2">Status</h4>
                {% if units[0].status == 'available' %}
                <span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-semibold">
                    <i class="fas fa-check mr-1"></i> Available
                </span>
                {% elif units[0].status == 'in_use' %}
                <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-semibold">
                    <i class="fas fa-user mr-1"></i> In Use
                </span>
                {% elif units[0].status == 'maintenance' %}
                <span class="px-3 py-1 bg-amber-100 text-amber-700 rounded-full text-sm font-semibold">
                    <i class="fas fa-tools mr-1"></i> Maintenance
                </span>
                {% else %}
                <span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm font-semibold">
                    {{ units[0].status|title }}
                </span>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Assets Table -->
<div class="bg-white rounded-xl shadow-md">
    <div class="p-6 border-b border-gray-200">
        <div class="flex items-center justify-between">
            <h3 class="text-lg font-semibold text-gray-800">
                <i class="fas fa-boxes mr-2 text-blue-600"></i>
                Daftar Aset ({{ unit_items|length }})
            </h3>
        </div>
    </div>
    <div class="p-6">
        {% if unit_items and unit_items|length > 0 %}
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead>
                    <tr class="border-b border-gray-200">
                        <th class="text-left py-3 px-4 font-semibold text-gray-700">Nama Aset</th>
                        <th class="text-left py-3 px-4 font-semibold text-gray-700">Kategori</th>
                        <th class="text-left py-3 px-4 font-semibold text-gray-700">Jumlah</th>
                        <th class="text-center py-3 px-4 font-semibold text-gray-700">Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item_group in unit_items %}
                    <tr class="border-b border-gray-100 hover:bg-gray-50">
                        <td class="py-4 px-4">
                            <div class="flex items-center">
                                <div class="bg-blue-100 rounded-lg p-2 mr-3">
                                    <i class="fas fa-box text-blue-600"></i>
                                </div>
                                <strong class="text-gray-800">{{ item_group.item.name }}</strong>
                            </div>
                        </td>
                        <td class="py-4 px-4">
                            {% if item_group.item.category %}
                            <span class="px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-xs font-semibold">
                                {{ item_group.item.category.name }}
                            </span>
                            {% else %}
                            <span class="text-gray-400">-</span>
                            {% endif %}
                        </td>
                        <td class="py-4 px-4">
                            <span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-bold">
                                {{ item_group.total_quantity }}
                            </span>
                        </td>
                        <td class="py-4 px-4 text-center">
                            <button onclick="openModal({{ loop.index }})" class="px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-semibold">
                                <i class="fas fa-eye mr-1"></i> Detail
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="text-center py-12 bg-gray-50 rounded-lg">
            <i class="fas fa-box-open text-gray-400 text-5xl mb-4"></i>
            <p class="text-gray-600 font-semibold">Belum ada aset di unit ini</p>
            <p class="text-sm text-gray-500 mt-1">Aset akan muncul setelah distribusi selesai</p>
            <a href="{{ url_for('asset_requests.create') }}" class="mt-4 inline-block px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                <i class="fas fa-plus mr-2"></i>Buat Permohonan Aset
            </a>
        </div>
        {% endif %}
    </div>
</div>

<!-- Detail Modals -->
{% for item_group in unit_items %}
<div id="detailModal-{{ loop.index }}" class="fixed inset-0 backdrop-blur-sm bg-gray-900/40 hidden items-center justify-center z-50">
    <div class="bg-white rounded-xl shadow-xl max-w-md w-full mx-4 max-h-[80vh] overflow-hidden">
        <div class="p-6 border-b border-gray-200 bg-blue-50">
            <div class="flex items-center justify-between">
                <div>
                    <h3 class="text-lg font-semibold text-gray-800">{{ item_group.item.name }}</h3>
                    <p class="text-sm text-gray-500">{{ item_group.item.category.name if item_group.item.category else '-' }}</p>
                </div>
                <button onclick="closeModal({{ loop.index }})" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
        </div>
        <div class="p-6 overflow-y-auto max-h-96">
            <h4 class="text-sm font-semibold text-gray-700 mb-3">
                <i class="fas fa-list mr-1"></i>Detail Barang ({{ item_group.details|length }})
            </h4>
            <div class="space-y-2">
                {% for detail in item_group.details %}
                <div class="bg-gray-50 rounded-lg p-3 border border-gray-200">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-semibold text-gray-800">
                            {% if detail.serial_number %}
                            <i class="fas fa-barcode mr-1"></i>SN: {{ detail.serial_number }}
                            {% else %}
                            <i class="fas fa-box mr-1"></i>Tanpa Serial Number
                            {% endif %}
                        </span>
                        <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs font-semibold">
                            {{ detail.status|title }}
                        </span>
                    </div>
                    <div class="text-xs text-gray-600 space-y-1">
                        <p><i class="fas fa-map-marker-alt mr-1 text-red-500"></i>{{ detail.location }}</p>
                        {% if detail.distribution_date %}
                        <p><i class="fas fa-calendar mr-1 text-green-500"></i>{{ detail.distribution_date|format_wib_datetime }}</p>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        <div class="p-4 border-t border-gray-200 bg-gray-50 flex justify-end">
            <button onclick="closeModal({{ loop.index }})" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-semibold">
                Tutup
            </button>
        </div>
    </div>
</div>
{% endfor %}

<script>
function openModal(index) {
    const modal = document.getElementById('detailModal-' + index);
    modal.classList.remove('hidden');
    modal.classList.add('flex');
}

function closeModal(index) {
    const modal = document.getElementById('detailModal-' + index);
    modal.classList.add('hidden');
    modal.classList.remove('flex');
}

// Close modal on outside click
document.addEventListener('click', function(event) {
    if (event.target.classList.contains('bg-gray-600')) {
        const modals = document.querySelectorAll('[id^="detailModal-"]');
        modals.forEach(function(modal) {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        });
    }
});
</script>
{% endblock %}
