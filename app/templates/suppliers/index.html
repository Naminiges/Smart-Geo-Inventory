{% extends "base.html" %}

{% block title %}Supplier - Smart Geo Inventory{% endblock %}

{% block page_title %}Manajemen Supplier{% endblock %}

{% block content %}
<!-- Quick Actions -->
<div class="mb-4 fade-in">
    <div class="bg-white rounded-xl shadow-md p-6">
        <div class="flex justify-between items-center">
            <div>
                <h5 class="text-lg font-semibold mb-1"><i class="fas fa-truck-loading mr-2"></i>Manajemen Supplier</h5>
                <p class="text-gray-500 mb-0">Kelola data supplier untuk pengadaan barang</p>
            </div>
            {% if current_user.is_admin() %}
            <a href="{{ url_for('suppliers.create') }}" class="bg-sky-500 hover:bg-sky-600 text-white px-4 py-2 rounded-lg transition-colors">
                <i class="fas fa-plus-circle mr-1"></i> Tambah Supplier
            </a>
            {% endif %}
        </div>
    </div>
</div>

<!-- Filter Section -->
<div class="mb-4">
    <div class="bg-white rounded-xl shadow-md p-6">
        <form method="GET" class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-2">Search</label>
                <input type="text" name="search" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-sky-500 focus:border-sky-500" placeholder="Cari nama supplier, kontak, email, atau telepon"
                       value="{{ search }}">
            </div>
            <div class="flex gap-2 items-end">
                <button type="submit" class="flex-1 bg-sky-500 hover:bg-sky-600 text-white px-4 py-2 rounded-lg transition-colors">
                    <i class="fas fa-search mr-1"></i> Cari
                </button>
                {% if search %}
                <a href="{{ url_for('suppliers.index') }}" class="border border-gray-300 text-gray-700 hover:bg-gray-50 px-4 py-2 rounded-lg transition-colors">
                    <i class="fas fa-times"></i>
                </a>
                {% endif %}
            </div>
        </form>
    </div>
</div>

<!-- Suppliers Table -->
<div>
    <div class="bg-white rounded-xl shadow-md overflow-hidden">
        <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
            <div class="flex items-center">
                <i class="fas fa-building mr-2 text-sky-500"></i>
                <h5 class="font-semibold mb-0">Daftar Supplier</h5>
            </div>
            <span class="bg-gray-100 text-gray-800 px-3 py-1 rounded-full text-sm">
                {% if pagination.total > 0 %}
                    {% set end_num = (pagination.page * pagination.per_page) %}
                    {% set show_end = end_num if end_num < pagination.total else pagination.total %}
                    Menampilkan {{ pagination.page * pagination.per_page - pagination.per_page + 1 }} - {{ show_end }} dari {{ pagination.total }} supplier
                {% else %}
                    Tidak ada data
                {% endif %}
            </span>
        </div>
        <div class="p-6 overflow-x-auto">
            <table class="w-full">
                <thead>
                    <tr class="border-b border-gray-200">
                        <th class="text-left py-3 px-2 text-sm font-medium text-gray-700">Nama Supplier</th>
                        <th class="text-left py-3 px-2 text-sm font-medium text-gray-700">Kontak Person</th>
                        <th class="text-left py-3 px-2 text-sm font-medium text-gray-700">Telepon</th>
                        <th class="text-left py-3 px-2 text-sm font-medium text-gray-700">Email</th>
                        <th class="text-left py-3 px-2 text-sm font-medium text-gray-700">Alamat</th>
                        <th class="text-left py-3 px-2 text-sm font-medium text-gray-700">Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    {% if suppliers and suppliers|length > 0 %}
                        {% for supplier in suppliers %}
                        <tr class="border-b border-gray-100 hover:bg-gray-50 transition-colors">
                            <td class="py-3 px-2">
                                <strong>{{ supplier.name }}</strong>
                            </td>
                            <td class="py-3 px-2">{{ supplier.contact_person or '-' }}</td>
                            <td class="py-3 px-2">{{ supplier.phone or '-' }}</td>
                            <td class="py-3 px-2">{{ supplier.email or '-' }}</td>
                            <td class="py-3 px-2">
                                <span class="text-sm text-gray-600">{{ supplier.address or '-' }}</span>
                            </td>
                            <td class="py-3 px-2">
                                <div class="flex gap-1">
                                    {% if current_user.is_admin() %}
                                    <a href="{{ url_for('suppliers.edit', id=supplier.id) }}"
                                       class="border border-sky-500 text-sky-500 hover:bg-sky-50 px-2 py-1 rounded text-sm transition-colors" title="Edit">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <button onclick="confirmDelete({{ supplier.id }}, '{{ supplier.name }}')"
                                            class="border border-red-500 text-red-500 hover:bg-red-50 px-2 py-1 rounded text-sm transition-colors" title="Hapus">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="6" class="text-center text-gray-500 py-8">
                                <i class="fas fa-inbox text-4xl mb-2 block"></i>
                                <strong>{% if search %}Tidak ditemukan supplier yang cocok{% else %}Belum ada data supplier{% endif %}</strong>
                                <p class="mb-0">{% if search %}Coba kata kunci lain{% else %}Mulai dengan menambahkan supplier baru{% endif %}</p>
                            </td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        {% if pagination.pages > 1 %}
        <nav class="mt-4 px-6 pb-6">
            <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
                <!-- Info Halaman -->
                <div class="text-sm text-gray-600">
                    Halaman <strong>{{ pagination.page }}</strong> dari <strong>{{ pagination.pages }}</strong>
                </div>

                <!-- Pagination Buttons -->
                <ul class="flex items-center gap-1">
                    <!-- First & Prev -->
                    {% if pagination.page > 1 %}
                    <li>
                        <a class="px-3 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors" href="{{ url_for('suppliers.index', page=1, search=search) }}">
                            <i class="fas fa-angle-double-left"></i>
                        </a>
                    </li>
                    <li>
                        <a class="px-3 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors" href="{{ url_for('suppliers.index', page=pagination.prev_num, search=search) }}">
                            <i class="fas fa-chevron-left"></i>
                        </a>
                    </li>
                    {% endif %}

                    <!-- Page Numbers - Show max 5 pages centered on current page -->
                    {% set start_page = [1, pagination.page - 2]|max %}
                    {% set end_page = [pagination.pages, pagination.page + 2]|min %}

                    {% if start_page > 1 %}
                    <li><span class="px-2 text-gray-500">...</span></li>
                    {% endif %}

                    {% for page_num in range(start_page, end_page + 1) %}
                        {% if page_num == pagination.page %}
                        <li>
                            <span class="px-3 py-2 bg-sky-500 text-white rounded-lg font-medium">{{ page_num }}</span>
                        </li>
                        {% else %}
                        <li>
                            <a class="px-3 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors" href="{{ url_for('suppliers.index', page=page_num, search=search) }}">
                                {{ page_num }}
                            </a>
                        </li>
                        {% endif %}
                    {% endfor %}

                    {% if end_page < pagination.pages %}
                    <li><span class="px-2 text-gray-500">...</span></li>
                    {% endif %}

                    <!-- Next & Last -->
                    {% if pagination.has_next %}
                    <li>
                        <a class="px-3 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors" href="{{ url_for('suppliers.index', page=pagination.next_num, search=search) }}">
                            <i class="fas fa-chevron-right"></i>
                        </a>
                    </li>
                    <li>
                        <a class="px-3 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors" href="{{ url_for('suppliers.index', page=pagination.pages, search=search) }}">
                            <i class="fas fa-angle-double-right"></i>
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </nav>
        {% endif %}
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-xl shadow-xl p-6 max-w-md w-full mx-4">
        <div class="flex items-center mb-4">
            <div class="bg-red-100 rounded-full p-3 mr-4">
                <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
            </div>
            <div>
                <h5 class="text-lg font-semibold text-gray-800 mb-1">Konfirmasi Hapus</h5>
                <p class="text-sm text-gray-500">Tindakan ini tidak dapat dibatalkan</p>
            </div>
        </div>
        <p class="text-gray-700 mb-6">Apakah Anda yakin ingin menghapus supplier <strong id="supplierName"></strong>?</p>
        <form id="deleteForm" method="POST" class="flex gap-3 justify-end">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <button type="button" onclick="closeDeleteModal()" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                Batal
            </button>
            <button type="submit" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                <i class="fas fa-trash mr-1"></i> Hapus
            </button>
        </form>
    </div>
</div>

<script>
function confirmDelete(id, name) {
    document.getElementById('supplierName').textContent = name;
    document.getElementById('deleteForm').action = '/suppliers/' + id + '/delete';
    document.getElementById('deleteModal').classList.remove('hidden');
    document.getElementById('deleteModal').classList.add('flex');
}

function closeDeleteModal() {
    document.getElementById('deleteModal').classList.add('hidden');
    document.getElementById('deleteModal').classList.remove('flex');
}

// Close modal on outside click
document.getElementById('deleteModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeDeleteModal();
    }
});
</script>
{% endblock %}
