<!DOCTYPE html>
<html lang="id" class="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}LOKASET Inventory{% endblock %}</title>

    <!-- Font Awesome Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />

    <!-- Leaflet CSS for maps -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />

    <!-- Custom CSS -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/output.css') }}"
    />

    {% block extra_css %}{% endblock %}
  </head>
  <body class="bg-gray-50">
    {% if current_user.is_authenticated %}
    <!-- Modern Sidebar Navigation -->
    <div class="flex h-screen overflow-hidden">
      <!-- Sidebar -->
      <nav
        class="w-64 bg-white border-r border-gray-200 flex-shrink-0 fixed lg:relative h-full transform -translate-x-full lg:translate-x-0 transition-transform duration-300 z-50 overflow-y-auto"
        id="sidebar"
      >
        <div class="px-4 lg:px-6 py-3 border-b border-gray-200">
          <div class="flex items-center space-x-3">
            <div>
              <h1 class="text-lg font-bold text-gray-800">LOKASET</h1>
              <p class="text-xs text-gray-500">Sistem Inventory Aset</p>
            </div>
          </div>
        </div>

        <div class="py-4 px-3 flex-1 overflow-y-auto">
          <!-- Menu Utama -->
          <p
            class="px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2"
          >
            Menu Utama
          </p>

          <a
            class="flex items-center px-3 py-2.5 rounded-lg {{ 'bg-emerald-50 text-emerald-700' if request.endpoint == 'dashboard.index' or request.endpoint == 'dashboard.warehouse_index' or request.endpoint == 'dashboard.admin_index' or request.endpoint == 'dashboard.field_index' or request.endpoint == 'dashboard.unit_index' else 'text-gray-700 hover:bg-gray-50' }} transition-all duration-200 mb-1"
            href="{{ url_for('dashboard.index') }}"
          >
            <i
              class="fas fa-home w-5 h-5 mr-3 text-center {{ 'text-emerald-600' if request.endpoint == 'dashboard.index' or request.endpoint == 'dashboard.warehouse_index' or request.endpoint == 'dashboard.admin_index' or request.endpoint == 'dashboard.field_index' or request.endpoint == 'dashboard.unit_index' else 'text-gray-400' }}"
            ></i>
            <span class="font-medium">Beranda</span>
            {% if request.endpoint == 'dashboard.index' or request.endpoint ==
            'dashboard.warehouse_index' or request.endpoint ==
            'dashboard.admin_index' or request.endpoint ==
            'dashboard.field_index' or request.endpoint == 'dashboard.unit_index' %}
            <div class="ml-auto w-1.5 h-1.5 bg-emerald-500 rounded-full"></div>
            {% endif %}
          </a>

          <!-- Peta GIS - Hanya untuk admin dan warehouse staff -->
          {% if current_user.is_admin() or current_user.is_warehouse_staff() %}
          <a
            class="flex items-center px-3 py-2.5 rounded-lg {{ 'bg-emerald-50 text-emerald-700' if 'map' in request.endpoint else 'text-gray-700 hover:bg-gray-50' }} transition-all duration-200 mb-1"
            href="{{ url_for('map.index') }}"
          >
            <i
              class="fas fa-map-marked-alt w-5 h-5 mr-3 text-center {{ 'text-emerald-600' if 'map' in request.endpoint else 'text-gray-400' }}"
            ></i>
            <span class="font-medium">Peta Lokasi Aset</span>
          </a>
          {% endif %}


          {% if current_user.is_field_staff() %}
          <!-- Field Staff Only Menu -->
          <p
            class="px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2 mt-4"
          >
            Menu Saya
          </p>

          <!-- Tugas Saya -->
          <a
            class="flex items-center px-3 py-2.5 rounded-lg {{ 'bg-emerald-50 text-emerald-700' if request.endpoint == 'field_tasks.index' else 'text-gray-700 hover:bg-gray-50' }} transition-all duration-200 mb-1"
            href="{{ url_for('field_tasks.index') }}"
          >
            <i
              class="fas fa-clipboard-check w-5 h-5 mr-3 text-center {{ 'text-emerald-600' if request.endpoint == 'field_tasks.index' else 'text-gray-400' }}"
            ></i>
            <span class="font-medium">Daftar Pekerjaan</span>
          </a>

          <a
            class="flex items-center px-3 py-2.5 rounded-lg {{ 'bg-emerald-50 text-emerald-700' if request.endpoint == 'field_tasks.map_view' else 'text-gray-700 hover:bg-gray-50' }} transition-all duration-200 mb-1"
            href="{{ url_for('field_tasks.map_view') }}"
          >
            <i
              class="fas fa-map w-5 h-5 mr-3 text-center {{ 'text-emerald-600' if request.endpoint == 'field_tasks.map_view' else 'text-gray-400' }}"
            ></i>
            <span class="font-medium">Peta Pekerjaan</span>
          </a>
          {% endif %}


          {% if current_user.is_unit_staff() %}
          <!-- Unit Staff Only Menu -->
          <p
            class="px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2 mt-4"
          >
            Menu Saya
          </p>

          <!-- Daftar Permohonan -->
          <a
            class="flex items-center px-3 py-2.5 rounded-lg {{ 'bg-emerald-50 text-emerald-700' if request.endpoint == 'asset_requests.index' or request.endpoint == 'asset_requests.create' or request.endpoint == 'asset_requests.detail' else 'text-gray-700 hover:bg-gray-50' }} transition-all duration-200 mb-1"
            href="{{ url_for('asset_requests.index') }}"
          >
            <i
              class="fas fa-file-alt w-5 h-5 mr-3 text-center {{ 'text-emerald-600' if request.endpoint == 'asset_requests.index' or request.endpoint == 'asset_requests.create' or request.endpoint == 'asset_requests.detail' else 'text-gray-400' }}"
            ></i>
            <span class="font-medium">Ajukan Permintaan</span>
            {% if pending_request_count > 0 %}
            <span class="ml-2 px-2 py-0.5 bg-red-500 text-white text-xs font-semibold rounded-full">
              {{ pending_request_count }}
            </span>
            {% endif %}
          </a>

          <!-- Aset di Unit -->
          <a
            class="flex items-center px-3 py-2.5 rounded-lg {{ 'bg-emerald-50 text-emerald-700' if request.endpoint == 'asset_requests.unit_assets' else 'text-gray-700 hover:bg-gray-50' }} transition-all duration-200 mb-1"
            href="{{ url_for('asset_requests.unit_assets') }}"
          >
            <i
              class="fas fa-box-open w-5 h-5 mr-3 text-center {{ 'text-emerald-600' if request.endpoint == 'asset_requests.unit_assets' else 'text-gray-400' }}"
            ></i>
            <span class="font-medium">Barang di Unit Saya</span>
          </a>

          <!-- Terima Distribusi -->
          <a
            class="flex items-center px-3 py-2.5 rounded-lg {{ 'bg-emerald-50 text-emerald-700' if 'distributions' in request.endpoint and 'receive' in request.endpoint else 'text-gray-700 hover:bg-gray-50' }} transition-all duration-200 mb-1"
            href="{{ url_for('distributions.receive_index') }}"
          >
            <i
              class="fas fa-download w-5 h-5 mr-3 text-center {{ 'text-emerald-600' if 'distributions' in request.endpoint and 'receive' in request.endpoint else 'text-gray-400' }}"
            ></i>
            <span class="font-medium">Terima Barang</span>
            {% if pending_distribution_count > 0 %}
            <span class="ml-2 px-2 py-0.5 bg-red-500 text-white text-xs font-semibold rounded-full">
              {{ pending_distribution_count }}
            </span>
            {% endif %}
          </a>

          <!-- Peminjaman Tempat -->
          <a
            class="flex items-center px-3 py-2.5 rounded-lg {{ 'bg-emerald-50 text-emerald-700' if 'asset_loans' in request.endpoint else 'text-gray-700 hover:bg-gray-50' }} transition-all duration-200 mb-1"
            href="{{ url_for('asset_loans.unit_index') }}"
          >
            <i
              class="fas fa-hand-holding-heart w-5 h-5 mr-3 text-center {{ 'text-emerald-600' if 'asset_loans' in request.endpoint else 'text-gray-400' }}"
            ></i>
            <span class="font-medium">Pinjam Tempat</span>
          </a>
          {% endif %}

          {% if current_user.is_warehouse_staff() or current_user.is_admin() %}
          <!-- Manajemen -->
          <p
            class="px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2 mt-4"
          >
            Menu Gudang
          </p>

          <!-- Pengadaan -->
          <a
            class="flex items-center px-3 py-2.5 rounded-lg {{ 'bg-emerald-50 text-emerald-700' if 'procurement' in request.endpoint else 'text-gray-700 hover:bg-gray-50' }} transition-all duration-200 mb-1"
            href="{{ url_for('procurement.index') }}"
          >
            <i
              class="fas fa-plus-circle w-5 h-5 mr-3 text-center {{ 'text-emerald-600' if 'procurement' in request.endpoint else 'text-gray-400' }}"
            ></i>
            <span class="font-medium">Pengadaan Baru</span>
            {% if current_user.is_admin() and pending_procurement_count > 0 %}
            <span class="ml-2 px-2 py-0.5 bg-red-500 text-white text-xs font-semibold rounded-full">
              {{ pending_procurement_count }}
            </span>
            {% endif %}
          </a>

          <!-- Barang -->
          <a
            class="flex items-center px-3 py-2.5 rounded-lg {{ 'bg-emerald-50 text-emerald-700' if 'items' in request.endpoint else 'text-gray-700 hover:bg-gray-50' }} transition-all duration-200 mb-1"
            href="{{ url_for('items.index') }}"
          >
            <i
              class="fas fa-boxes w-5 h-5 mr-3 text-center {{ 'text-emerald-600' if 'items' in request.endpoint else 'text-gray-400' }}"
            ></i>
            <span class="font-medium">Daftar Barang</span>
          </a>

          <!-- Kategori Barang -->
          <a
            class="flex items-center px-3 py-2.5 rounded-lg {{ 'bg-emerald-50 text-emerald-700' if 'categories' in request.endpoint else 'text-gray-700 hover:bg-gray-50' }} transition-all duration-200 mb-1"
            href="{{ url_for('categories.index') }}"
          >
            <i
              class="fas fa-tags w-5 h-5 mr-3 text-center {{ 'text-emerald-600' if 'categories' in request.endpoint else 'text-gray-400' }}"
            ></i>
            <span class="font-medium">Kategori Barang</span>
          </a>

          <!-- Unit (Admin Only) -->
          {% if current_user.is_admin() %}
          <a
            class="flex items-center px-3 py-2.5 rounded-lg {{ 'bg-emerald-50 text-emerald-700' if 'units' in request.endpoint else 'text-gray-700 hover:bg-gray-50' }} transition-all duration-200 mb-1"
            href="{{ url_for('units.index') }}"
          >
            <i
              class="fas fa-building w-5 h-5 mr-3 text-center {{ 'text-emerald-600' if 'units' in request.endpoint else 'text-gray-400' }}"
            ></i>
            <span class="font-medium">Daftar Unit</span>
            {% if pending_request_count > 0 %}
            <span class="ml-2 px-2 py-0.5 bg-red-500 text-white text-xs font-semibold rounded-full">
                {{ pending_request_count }}
            </span>
            {% endif %}
          </a>
          {% endif %}

          <!-- Distribusi -->
          <p
            class="px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2 mt-4"
          >
            Kirim Barang
          </p>

          <!-- Permohonan Aset (Warehouse Staff & Admin) -->
          <a
          class="flex items-center px-3 py-2.5 rounded-lg
          {{ 'bg-emerald-50 text-emerald-700' if 'asset_requests' in request.endpoint else 'text-gray-700 hover:bg-gray-50' }}
          transition-all duration-200 mb-1"
          href="{{ url_for('asset_requests.index') }}"
        >
          <i
            class="fas fa-file-signature w-5 h-5 mr-3 text-center
            {{ 'text-emerald-600' if 'asset_requests' in request.endpoint else 'text-gray-400' }}"
          ></i>

          <span class="font-medium">Permintaan dari Unit</span>

          {% if current_user.is_admin() and pending_request_count > 0 %}
            <span class="ml-auto px-2 py-0.5 bg-red-500 text-white text-xs font-semibold rounded-full">
              {{ pending_request_count }}
            </span>
          {% elif current_user.is_warehouse_staff() and verified_request_count > 0 %}
            <span class="ml-auto px-2 py-0.5 bg-red-500 text-white text-xs font-semibold rounded-full">
              {{ verified_request_count }}
            </span>
          {% endif %}
        </a>

          <a
          class="flex items-center px-3 py-2.5 rounded-lg
          {{ 'bg-emerald-50 text-emerald-700' if 'installations' in request.endpoint else 'text-gray-700 hover:bg-gray-50' }}
          transition-all duration-200"
          href="{{ url_for('installations.index') }}"
        >
          <i
            class="fas fa-share-square w-5 h-5 mr-3 text-center
            {{ 'text-emerald-600' if 'installations' in request.endpoint else 'text-gray-400' }}"
          ></i>

          <span class="font-medium">Kirim Langsung</span>

          {% if draft_distribution_count > 0 %}
            <span class="ml-auto px-2 py-0.5 bg-red-500 text-white text-xs font-semibold rounded-full">
              {{ draft_distribution_count }}
            </span>
          {% endif %}
        </a>

          <!-- Retur Barang (Warehouse Staff & Admin Only) -->
          <a
            class="flex items-center px-3 py-2.5 rounded-lg {{ 'bg-emerald-50 text-emerald-700' if 'returns' in request.endpoint else 'text-gray-700 hover:bg-gray-50' }} transition-all duration-200 mb-1"
            href="{{ url_for('returns.index') }}"
          >
            <i
              class="fas fa-undo-alt w-5 h-5 mr-3 text-center {{ 'text-emerald-600' if 'returns' in request.endpoint else 'text-gray-400' }}"
            ></i>
            <span class="font-medium">Barang Kembali</span>
          </a>

          <!-- Stok (All Users) -->
          <a
            class="flex items-center px-3 py-2.5 rounded-lg {{ 'bg-emerald-50 text-emerald-700' if 'stock' in request.endpoint else 'text-gray-700 hover:bg-gray-50' }} transition-all duration-200 mb-1"
            href="{{ url_for('stock.index') }}"
          >
            <i
              class="fas fa-history w-5 h-5 mr-3 text-center {{ 'text-emerald-600' if 'stock' in request.endpoint else 'text-gray-400' }}"
            ></i>
            <span class="font-medium">Riwayat Keluar Masuk</span>
          </a>

          <!-- Supplier -->
          {% if current_user.is_admin() or current_user.is_warehouse_staff() or current_user.is_unit_staff() %}
          <a
            class="flex items-center px-3 py-2.5 rounded-lg {{ 'bg-emerald-50 text-emerald-700' if 'suppliers' in request.endpoint else 'text-gray-700 hover:bg-gray-50' }} transition-all duration-200 mb-1"
            href="{{ url_for('suppliers.index') }}"
          >
            <i
              class="fas fa-truck w-5 h-5 mr-3 text-center {{ 'text-emerald-600' if 'suppliers' in request.endpoint else 'text-gray-400' }}"
            ></i>
            <span class="font-medium">Daftar Supplier</span>
          </a>

          <!-- Manajemen User (Admin Only) -->
          {% if current_user.is_admin() %}
          <p
            class="px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2 mt-4"
          >
            Pengaturan
          </p>

          <a
            class="flex items-center px-3 py-2.5 rounded-lg {{ 'bg-emerald-50 text-emerald-700' if 'users' in request.endpoint else 'text-gray-700 hover:bg-gray-50' }} transition-all duration-200 mb-1"
            href="{{ url_for('users.index') }}"
          >
            <i
              class="fas fa-users w-5 h-5 mr-3 text-center {{ 'text-emerald-600' if 'users' in request.endpoint else 'text-gray-400' }}"
            ></i>
            <span class="font-medium">Kelola Pengguna</span>
          </a>
          {% endif %}
          {% endif %} {% endif %}
        </div>

        <div
          class="sticky bottom-0 left-0 right-0 p-4 border-t border-gray-200 bg-white"
        >
          <div class="flex items-center mb-3 p-2 bg-gray-50 rounded-lg">
            <div
              class="bg-emerald-600 rounded-full flex items-center justify-center mr-3"
              style="width: 40px; height: 40px"
            >
              <i class="fas fa-user text-lg text-white"></i>
            </div>
            <div class="flex-1 min-w-0">
              <p class="text-sm font-semibold text-gray-800 truncate">
                {{ current_user.name }}
              </p>
              <p class="text-xs text-gray-500">{{ current_user.role|replace('_', ' ')|title }}</p>
            </div>
          </div>
          <a
            href="{{ url_for('auth.logout') }}"
            class="logout-btn flex items-center justify-center w-full px-3 py-2.5 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors duration-200 text-sm font-medium"
          >
            <i class="fas fa-sign-out-alt mr-2 text-gray-500"></i>
            Keluar
          </a>
        </div>
      </nav>

      <!-- Main Content -->
      <main class="flex-1 lg:ml-0 overflow-y-auto min-h-screen flex flex-col">
        <!-- Top Navigation Bar -->
        <nav class="bg-white border-b border-gray-200 sticky top-0 z-40 flex-shrink-0">
          <div
            class="w-full px-4 lg:px-6 py-3 flex items-center justify-between"
          >
            <div class="flex items-center space-x-4">
              <button
                class="lg:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors"
                type="button"
                onclick="document.getElementById('sidebar').classList.toggle('-translate-x-full')"
              >
                <i class="fas fa-bars text-gray-600"></i>
              </button>
              <div class="flex items-center space-x-2">
                <div
                  class="w-8 h-8 bg-emerald-100 rounded-lg flex items-center justify-center"
                >
                  <i class="fas fa-th text-emerald-600 text-sm"></i>
                </div>
                <h1 class="text-lg font-semibold text-gray-800">
                  {% block page_title %}Beranda{% endblock %}
                </h1>
              </div>
            </div>

            <div class="flex items-center space-x-1">
              <div class="relative ml-2">
                <button
                  class="p-2 rounded-lg hover:bg-gray-100 transition-colors"
                  onclick="this.nextElementSibling.classList.toggle('hidden')"
                >
                  <i class="fas fa-user-circle text-gray-500 text-xl"></i>
                </button>
                <div
                  class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-50"
                >
                  <a
                    class="flex items-center px-4 py-2.5 hover:bg-gray-50 text-gray-700 hover:text-emerald-600 transition-colors"
                    href="{{ url_for('auth.profile') }}"
                  >
                    <i class="fas fa-user mr-3 w-4 text-gray-400"></i>
                    <span>Profil Saya</span>
                  </a>
                  <div class="border-t border-gray-200"></div>
                  <a
                    class="logout-btn flex items-center px-4 py-2.5 hover:bg-gray-50 text-red-600 transition-colors"
                    href="{{ url_for('auth.logout') }}"
                  >
                    <i class="fas fa-sign-out-alt mr-3 w-4"></i>
                    <span>Keluar</span>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </nav>

        <!-- Flash Messages -->
        <div class="px-4 lg:px-6 mt-3 flex-shrink-0">
          {% with messages = get_flashed_messages(with_categories=true) %} {% if
          messages %} {% for category, message in messages %}
          <div
            class="alert {{ 'bg-emerald-50 border-emerald-400 text-emerald-800' if category == 'success' else 'bg-red-50 border-red-400 text-red-800' if category == 'danger' else 'bg-amber-50 border-amber-400 text-amber-800' if category == 'warning' else 'bg-blue-50 border-blue-400 text-blue-800' }} border-l-4 rounded-lg p-4 shadow-md flex items-center justify-between mb-3"
            role="alert"
          >
            <div class="flex items-center">
              <div
                class="{{ 'bg-emerald-100 text-emerald-700' if category == 'success' else 'bg-red-100 text-red-700' if category == 'danger' else 'bg-amber-100 text-amber-700' if category == 'warning' else 'bg-blue-100 text-blue-700' }} rounded-full p-2 mr-3"
              >
                <i
                  class="fas {% if category == 'success' %}fa-check-circle{% elif category == 'danger' %}fa-exclamation-triangle{% elif category == 'warning' %}fa-exclamation-circle{% else %}fa-info-circle{% endif %}"
                ></i>
              </div>
              <div class="flex-1">
                <p class="font-medium">{{ message }}</p>
              </div>
            </div>
            <button
              type="button"
              class="ml-4 text-gray-400 hover:text-gray-600 transition-colors"
              onclick="this.parentElement.remove()"
            >
              <i class="fas fa-times"></i>
            </button>
          </div>
          {% endfor %} {% endif %} {% endwith %}
        </div>

        <!-- Page Content -->
        <div class="p-4 pb-20 flex-1">{% block content %}{% endblock %}</div>

        <!-- Footer -->
        <footer class="bg-white border-t border-gray-200 mt-auto flex-shrink-0">
          <div class="w-full px-4 lg:px-6 py-4">
            <div
              class="flex flex-col md:flex-row items-center justify-between space-y-2 md:space-y-0"
            >
              <div class="flex items-center space-x-2 text-sm text-gray-600">
                <i class="fas fa-boxes text-emerald-600"></i>
                <span
                  >&copy; 2026 LOKASET - Universitas Sumatera
                  Utara</span
                >
              </div>
            </div>
          </div>
        </footer>
      </main>
    </div>

    {% else %}
    <!-- Content for non-authenticated users (login page) -->
    <div class="w-full">{% block auth_content %}{% endblock %}</div>
    {% endif %}

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Chart.js for analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <!-- Custom JavaScript -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>

    <!-- Confirm Helper -->
    <script src="{{ url_for('static', filename='js/confirm.js') }}"></script>

    {% block extra_js %}{% endblock %}
  </body>
</html>
